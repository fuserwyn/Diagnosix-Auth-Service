# Diagnosix Auth-Service ü©∫

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–ª—è Diagnosix MVP.

–ü–æ–∑–≤–æ–ª—è–µ—Ç:
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (`/register`)
- üîê –í—ã–ø–æ–ª–Ω—è—Ç—å –≤—Ö–æ–¥ —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π JWT —Ç–æ–∫–µ–Ω–æ–≤ (`/login`)
- üë§ –ü–æ–ª—É—á–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ (`/me`)
- üõ° –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø –ø–æ —Ä–æ–ª—è–º (`/dashboard`, —Ç–æ–ª—å–∫–æ –¥–ª—è `admin`)

---

## üì¶ –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

- **FastAPI** ‚Äî –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **PostgreSQL** ‚Äî –°–£–ë–î (—á–µ—Ä–µ–∑ `asyncpg`)
- **SQLAlchemy 2.0** + Alembic ‚Äî ORM –∏ –º–∏–≥—Ä–∞—Ü–∏–∏
- **Pydantic v2** ‚Äî —Å—Ö–µ–º—ã –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è
- **JWT** (`python-jose`) ‚Äî –¥–ª—è —Ç–æ–∫–µ–Ω–æ–≤
- **Docker + Docker Compose**
- **Pytest** ‚Äî —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- **Pre-commit hooks** ‚Äî –∫–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞

---

## üß™ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ API

| –ú–µ—Ç–æ–¥ | –≠–Ω–¥–ø–æ–∏–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| `POST` | `/register` | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `POST` | `/login` | –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è, –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ |
| `GET` | `/me` | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ |
| `GET` | `/dashboard` | –¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ (–ø–æ JWT-—Ä–æ–ª—è–º) |

---

## üöÄ –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker

```bash
git clone git@github.com:fuserwyn/Diagnosix-Auth-Service.git
cd Diagnosix-Auth-Service
cp .env.example .env
make up
```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: [http://localhost:8000/docs](http://localhost:8000/docs)

---

## üìÇ –ü—Ä–∏–º–µ—Ä `.env`

```env
DB_HOST=db
DB_PORT=5432
DB_NAME=auth_db
DB_USER=postgres
DB_PASSWORD=postgres
SECRET_KEY=supersecret
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–∫–∞–ª—å–Ω–æ:
```bash
make test
```

### –í Docker:
```bash
docker-compose exec web bash
pytest -s
```

---

## üì¨ –ü—Ä–∏–º–µ—Ä—ã curl-–∑–∞–ø—Ä–æ—Å–æ–≤

### üîê –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

```bash
curl -X POST http://localhost:8000/register \
 -H "Content-Type: application/json" \
 -d '{"email": "test@example.com", "password": "qwerty123", "role": "doctor"}'
```

### üîë –í—Ö–æ–¥

```bash
curl -X POST http://localhost:8000/login \
 -H "Content-Type: application/json" \
 -d '{"email": "test@example.com", "password": "qwerty123"}'
```

### üë§ –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```bash
curl -X GET http://localhost:8000/me \
 -H "Authorization: Bearer <–≤–∞—à_—Ç–æ–∫–µ–Ω>"
```

---

## üß≠ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
auth_service/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ main.py               # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è FastAPI
‚îÇ   ‚îú‚îÄ‚îÄ auth/                 # JWT –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ routes/               # –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ schemas/              # Pydantic-—Å—Ö–µ–º—ã
‚îÇ   ‚îú‚îÄ‚îÄ services/             # –õ–æ–≥–∏–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ models/               # SQLAlchemy-–º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ core/config.py        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (pydantic-settings)
‚îÇ   ‚îú‚îÄ‚îÄ repositories/         # –°–ª–æ–π –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º (UserRepo –∏ –±–∞–∑–æ–≤—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π)
‚îÇ   ‚îú‚îÄ‚îÄ database/db.py        # –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
‚îÇ   ‚îî‚îÄ‚îÄ tests/                # –¢–µ—Å—Ç—ã –≤–Ω—É—Ç—Ä–∏ app/
‚îú‚îÄ‚îÄ migrations/               # –ú–∏–≥—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ README.md
```

---

## üõ° –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–æ–ª–µ–π –∏ —Ä–æ–ª–µ–π —á–µ—Ä–µ–∑ Pydantic
- –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π (`passlib`)
- JWT —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–æ–ª–µ–π (`admin`, `doctor`, `patient`)
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ —á–µ—Ä–µ–∑ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã (`Depends(role_required(...))`)

---

## üß™ –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

- `register`, `login`, `me`, `dashboard` –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `pytest`, `pytest-asyncio`, `httpx`

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è UUID –≤ –∫–∞—á–µ—Å—Ç–≤–µ `id`
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Å—Ç–µ–∫ (FastAPI + asyncpg + SQLAlchemy 2.0)
- JWT access/refresh —Ç–æ–∫–µ–Ω—ã
- –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–∑–¥–µ–ª—ë–Ω–Ω—ã–µ —Å–ª–æ–∏: `routes ‚Üí services ‚Üí repo`

---
## üìú –ú–∏–≥—Ä–∞—Ü–∏–∏ Alembic

–ú–∏–≥—Ä–∞—Ü–∏–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `migrations/`. –î–ª—è –∏—Ö –∑–∞–ø—É—Å–∫–∞:

### üîº –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏

–í Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ:
```bash
alembic revision --autogenerate -m "your message"
```

### ‚¨ÜÔ∏è –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

```bash
alembic upgrade head
```

---

## üõ† Makefile (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Makefile`:

```makefile
migrations:
	alembic revision --autogenerate

migrate:
	alembic upgrade head
```

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

```bash
make run
make migrate
make test
```
Enjoy üë®‚Äç‚öïÔ∏è‚ú®